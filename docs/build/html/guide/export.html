

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Exporting models &mdash; NEORL 1.1.3b documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> NEORL
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                main (1.1.3b )
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">General Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Algorithms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/a2c.html">Advantage Actor Critic (A2C)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/dqn.html">Deep Q Learning (DQN)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/ppo2.html">Proximal Policy Optimisation (PPO)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/es.html">Evolution Strategies (ES)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/pso.html">Particle Swarm Optimisation (PSO)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/de.html">Differential Evolution (DE)</a></li>
</ul>
<p class="caption"><span class="caption-text">Hyperparameter Tuning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tune/grid.html">Grid Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tune/random.html">Random Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tune/evolu.html">Evolutionary Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tune/bayes.html">Bayesian Search</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/ex1.html">Example 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/ex2.html">Example 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/ex3.html">Example 3</a></li>
</ul>
<p class="caption"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/projects.html">Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/contrib.html">Contributors</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NEORL</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Exporting models</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/guide/export.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="exporting-models">
<span id="export"></span><h1>Exporting models<a class="headerlink" href="#exporting-models" title="Permalink to this headline">¶</a></h1>
<p>After training an agent, you may want to deploy/use it in an other language
or framework, like PyTorch or <a class="reference external" href="https://github.com/tensorflow/tfjs">tensorflowjs</a>.
Stable Baselines does not include tools to export models to other frameworks, but
this document aims to cover parts that are required for exporting along with
more detailed stories from users of Stable Baselines.</p>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>In Stable Baselines, the controller is stored inside <span class="xref std std-ref">policies</span> which convert
observations into actions. Each learning algorithm (e.g. DQN, A2C, SAC) contains
one or more policies, some of which are only used for training. An easy way to find
the policy is to check the code for the <code class="docutils literal notranslate"><span class="pre">predict</span></code> function of the agent:
This function should only call one policy with simple arguments.</p>
<p>Policies hold the necessary Tensorflow placeholders and tensors to do the
inference (i.e. predict actions), so it is enough to export these policies
to do inference in an another framework.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Learning algorithms also may contain other Tensorflow placeholders, that are used for training only and are
not required for inference.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When using CNN policies, the observation is normalized internally (dividing by 255 to have values in [0, 1])</p>
</div>
</div>
<div class="section" id="export-to-pytorch">
<h2>Export to PyTorch<a class="headerlink" href="#export-to-pytorch" title="Permalink to this headline">¶</a></h2>
<p>A known working solution is to use <code class="xref py py-func docutils literal notranslate"><span class="pre">get_parameters</span></code>
function to obtain model parameters, construct the network manually in PyTorch and assign parameters correctly.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>PyTorch and Tensorflow have internal differences with e.g. 2D convolutions (see discussion linked below).</p>
</div>
<p>See <a class="reference external" href="https://github.com/hill-a/stable-baselines/issues/372">discussion #372</a> for details.</p>
</div>
<div class="section" id="export-to-c">
<h2>Export to C++<a class="headerlink" href="#export-to-c" title="Permalink to this headline">¶</a></h2>
<p>Tensorflow, which is the backbone of Stable Baselines, is fundamentally a C/C++ library despite being most commonly accessed
through the Python frontend layer. This design choice means that the models created at Python level should generally be
fully compliant with the respective C++ version of Tensorflow.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is advisable not to mix-and-match different versions of Tensorflow libraries, particularly in terms of the state.
Moving computational graphs is generally more forgiving. As a matter of fact, mentioned below <a class="reference external" href="https://github.com/Antymon/ppo_cpp">PPO_CPP</a> project uses
graphs generated with Python Tensorflow 1.x in C++ Tensorflow 2 version.</p>
</div>
<p>Stable Baselines comes very handily when hoping to migrate a computational graph and/or a state (weights) as
the existing algorithms define most of the necessary computations for you so you don’t need to recreate the core of the algorithms again.
This is exactly the idea that has been used in the <a class="reference external" href="https://github.com/Antymon/ppo_cpp">PPO_CPP</a> project, which executes the training at the C++ level for the sake of
computational efficiency. The graphs are exported from Stable Baselines’ PPO2 implementation through <code class="docutils literal notranslate"><span class="pre">tf.train.export_meta_graph</span></code>
function. Alternatively, and perhaps more commonly, you could use the C++ layer only for inference. That could be useful
as a deployment step of server backends or optimization for more limited devices.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>As a word of caution, C++-level APIs are more imperative than their Python counterparts or more plainly speaking: cruder.
This is particularly apparent in Tensorflow 2.0 where the declarativeness of Autograph exists only at Python level. The
C++ counterpart still operates on Session objects’ use, which are known from earlier versions of Tensorflow. In our use case,
availability of graphs utilized by Session depends on the use of <code class="docutils literal notranslate"><span class="pre">tf.function</span></code> decorators. However, as of November 2019, Stable Baselines still
uses Tensorflow 1.x in the main version which is slightly easier to use in the context of the C++ portability.</p>
</div>
</div>
<div class="section" id="export-to-tensorflowjs-tfjs">
<h2>Export to tensorflowjs / tfjs<a class="headerlink" href="#export-to-tensorflowjs-tfjs" title="Permalink to this headline">¶</a></h2>
<p>Can be done via Tensorflow’s <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/saved_model/simple_save">simple_save</a> function
and <a class="reference external" href="https://www.tensorflow.org/js/tutorials/conversion/import_saved_model">tensorflowjs_converter</a>.</p>
<p>See <a class="reference external" href="https://github.com/hill-a/stable-baselines/issues/474">discussion #474</a> for details.</p>
</div>
<div class="section" id="export-to-java">
<h2>Export to Java<a class="headerlink" href="#export-to-java" title="Permalink to this headline">¶</a></h2>
<p>Can be done via Tensorflow’s <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/saved_model/simple_save">simple_save</a> function.</p>
<p>See <a class="reference external" href="https://github.com/hill-a/stable-baselines/issues/329">this discussion</a> for details.</p>
</div>
<div class="section" id="manual-export">
<h2>Manual export<a class="headerlink" href="#manual-export" title="Permalink to this headline">¶</a></h2>
<p>You can also manually export required parameters (weights) and construct the
network in your desired framework, as done with the PyTorch example above.</p>
<p>You can access parameters of the model via agents’
<code class="xref py py-func docutils literal notranslate"><span class="pre">get_parameters</span></code>
function. If you use default policies, you can find the architecture of the networks in
source for <span class="xref std std-ref">policies</span>. Otherwise, for DQN/SAC/DDPG or TD3 you need to check the <cite>policies.py</cite> file located
in their respective folders.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Exelon Corp. &amp; MIT.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>